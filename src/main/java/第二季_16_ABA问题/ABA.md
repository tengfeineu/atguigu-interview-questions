> 视频P17到P19
>
> 
>
> <font color="#ff0000" size="6">**CAS-->unsafe-->CAS底层原理(不断循环--自旋)-->ABA问题-->原子引用更新-->如何规避ABA问题**</font> 



# ABA问题的产生--<font color="#ff0000" size="6">**狸猫换太子**</font>

![ABA问题.png](http://ww1.sinaimg.cn/large/005IGVTXly1gbp16d19t3j31hc0u04lc.jpg)
如果只管头尾的值是否一致，那就可以忽略ABA问题，不然的话就是有问题的  

# 如何解决ABA问题
原子类已经不够用了，使用AtomicReference<V>类+版本号(时间戳)  
AtomicStampedReference

| 执行时间 | 线程 | 数值 | 版本号 | 数值 | 版本号 | 数值 | 版本号                                  |
| -------- | ---- | ---- | ------ | ---- | ------ | ---- | --------------------------------------- |
| 10s      | T1   | 100  | 1      |      |        | 2019 | <font color="#ff0000" size="4">2</font> |
| 2s       | T2   | 100  | 1      | 101  | 2      | 100  | <font color="#ff0000" size="4">3</font> |

T2中间过程修改变量数值后又改成了100版本号为3，T1去修改的时候发现版本工作内存中版本号为2，所以不能直接修改需要，重新从主内存中获取新的变量值和版本号才能修改。